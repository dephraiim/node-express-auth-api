## Node.js Auth API

A Simple Authentication RESTful API using Node.js, Express, and Mongoose.

By running a single command, you will get a production-ready Node.js app installed and fully configured on your machine. The app comes authentication using JWT, request validation

 <!-- unit and integration tests, continuous integration, docker support, API documentation, pagination, etc. For more details, check the features list below. -->

## Manual Installation

If you would still prefer to do the installation manually, follow these steps:

Clone the repo:

```bash
git clone https://github.com/dephraiim/node-express-auth-api
cd node-express-auth-api
```

Install the dependencies:

```bash
pnpm install
```

Set the environment variables:

```bash
cp .env.example .env

# open .env and modify the environment variables (if needed)

```

## Table of Contents

- [Features](#features)
- [Commands](#commands)
- [Environment Variables](#environment-variables)
- [Project Structure](#project-structure)
- [Validation](#validation)
- [Authentication](#authentication)
- [Authorization](#authorization)
- [Contributing](#contributing)

## Features

- **NoSQL database**: [MongoDB](https://www.mongodb.com) object data modeling using [Mongoose](https://mongoosejs.com)
- **Authentication and authorization**: using [JWT](http://www.passportjs.org)
- **Validation**: request data validation using [Joi](https://github.com/hapijs/joi)
- **Logging**: using [morgan](https://github.com/expressjs/morgan)

- **Error handling**: centralized error handling mechanism using [http-errors]()

- **Environment variables**: using [dotenv](https://github.com/motdotla/dotenv)
    <!-- - **Security**: set security HTTP headers using [helmet](https://helmetjs.github.io) -->
    <!-- - **Santizing**: sanitize request data against xss and query injection -->
    <!-- - **CORS**: Cross-Origin Resource-Sharing enabled using [cors](https://github.com/expressjs/cors) -->
    <!-- - **Compression**: gzip compression with [compression](https://github.com/expressjs/compression) -->
    <!-- - **CI**: continuous integration with [Travis CI](https://travis-ci.org) -->
    <!-- - **Docker support** -->
    <!-- - **Git hooks**: with [husky](https://github.com/typicode/husky) and [lint-staged](https://github.com/okonet/lint-staged) -->
  <!-- - **Linting**: with [ESLint](https://eslint.org) and [Prettier](https://prettier.io) -->
  <!-- - **Editor config**: consistent editor configuration using [EditorConfig](https://editorconfig.org) -->

    <!-- - **Testing**: unit and integration tests using [Jest](https://jestjs.io) -->

    <!-- - **API documentation**: with [swagger-jsdoc](https://github.com/Surnet/swagger-jsdoc) and [swagger-ui-express](https://github.com/scottie1984/swagger-ui-express) -->

    <!-- - **Process management**: advanced production process management using [PM2](https://pm2.keymetrics.io) -->
  <!-- - **Dependency management**: with [pnpm](https://pnpmpkg.com) -->

## Commands

Running locally:

```bash
pnpm dev
```

## Environment Variables

The environment variables can be found and modified in the `.env` file. They come with these default values:

```bash
# Port number
PORT=3000

# URL of the Mongo DB
MONGODB_URL=mongodb://127.0.0.1:27017/
DB_NAME=node_express_auth_api


# JWT
# JWT secret key
ACCESS_TOKEN_SECRET=""
REFRESH_TOKEN_SECRET=""
```

## Project Structure

```
src\
 |--controllers\    # Route controllers (controller layer)
 |--models\         # Mongoose models (data layer)
 |--routes\         # Routes
 |--lib\            # Utility classes and functions
 |--app.js          # Express app
```

## API Endpoints

List of available routes:

**Auth routes**:\
`POST /auth/register` - register\
`POST /auth/login` - login\
`POST /auth/refresh` - refresh auth tokens\
`POST /auth/logout` - logout a user\

<!-- `POST /auth/forgot-password` - send reset password email\ -->
<!-- `POST /auth/reset-password` - reset password\ -->
<!-- `POST /auth/send-verification-email` - send verification email\ -->
<!-- `POST /auth/verify-email` - verify email -->
<!--
**User routes**:\
`POST /users` - create a user\
`GET /users` - get all users\
`GET /users/:userId` - get user\
`PATCH /users/:userId` - update user\
`DELETE /users/:userId` - delete user -->

## Authentication and Authorization

These routes require a valid JWT access token in the Authorization request header using the Bearer schema. If the request does not contain a valid access token, an Unauthorized (401) error is thrown.

**Generating Access Tokens**:

An access token can be generated by making a successful call to the register (`POST /auth/register`) or login (`POST /auth/login`) endpoints. The response of these endpoints also contains refresh tokens (explained below).

**Refreshing Access Tokens**:

After the access token expires, a new access token can be generated, by making a call to the refresh token endpoint (`POST /auth/refresh`) and sending along a valid refresh token in the request body. This call returns a new access token and a new refresh token.

<!-- ## Authorization -->

<!-- The `auth` middleware can also be used to require certain rights/permissions to access a route.

```javascript
const express = require("express");
const auth = require("../../middlewares/auth");
const userController = require("../../controllers/user.controller");

const router = express.Router();

router.post("/users", auth("manageUsers"), userController.createUser);
```

In the example above, an authenticated user can access this route only if that user has the `manageUsers` permission.

The permissions are role-based. You can view the permissions/rights of each role in the `src/config/roles.js` file.

If the user making the request does not have the required permissions to access this route, a Forbidden (403) error is thrown. -->

<!-- ## Linting

Linting is done using [ESLint](https://eslint.org/) and [Prettier](https://prettier.io).

In this app, ESLint is configured to follow the [Airbnb JavaScript style guide](https://github.com/airbnb/javascript/tree/master/packages/eslint-config-airbnb-base) with some modifications. It also extends [eslint-config-prettier](https://github.com/prettier/eslint-config-prettier) to turn off all rules that are unnecessary or might conflict with Prettier.

To modify the ESLint configuration, update the `.eslintrc.json` file. To modify the Prettier configuration, update the `.prettierrc.json` file.

To prevent a certain file or directory from being linted, add it to `.eslintignore` and `.prettierignore`.

To maintain a consistent coding style across different IDEs, the project contains `.editorconfig` -->

## Contributing

Contributions are more than welcome! Please check out the [contributing guide](CONTRIBUTING.md).

## License

[MIT](LICENSE)
